<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
<head>
    <meta charset='utf-8'>
    <title>Fresco | Requesting Multiple Images (Multi-URI)</title>
    <link rel='stylesheet' href='/static/site.css' type='text/css'/>
    <link rel="stylesheet" href='/static/pygments.css' type='text/css'/>
    <link rel='shortcut icon' href='/static/favicon.png'>
    <meta name='viewport' content='width=480'>
    <meta property="og:title" content="Requesting Multiple Images (Multi-URI)" />
    <meta property="og:site_name" content="fresco">
    <meta property='og:description' content='Fresco is an image management library.'>
    <meta property='og:image' content='http://facebook.github.io/fresco/static/fresco-og-image.png'>
    <meta property='og:url' content="http://facebook.github.io/fresco/docs/requesting-multiple-images.html">
    
    <meta property='og:type' content='website'>
    
    <script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script>
    <script type="text/javascript">{'try{Typekit.load();}catch(e){}'}</script>
    <!-- Google Analytics -->
</head>
<body>

<header class='topbar'><nav class='width'>
<a href='/'>
  <img src="/static/fresco-logo.png" class="logo">
</a>
    <ul>
      <li><a href="/docs/index.html#_"
          
          class="active" >
          Docs
      </a></li>
      <li><a href="/"
          >
          About
      </a></li>
      <li><a href="/support.html"
          >
          Support
      </a></li>
      <li><a href="/javadoc">
          API
      </a></li>
      <li><a href="http://github.com/facebook/fresco">GitHub</a></li>
      <li><a href="http://fresco-cn.org">中文版</a></li>
    </ul>
</nav></header>


<section class='content'><div class='width'>

<nav class='toc'>
  
    <section>
      <h3>Quick Start</h3>
      <ul>
        
          <li>
            <a href="/docs/index.html#_">
              Adding Fresco to your Project
            </a>
            
          </li>
        
          <li>
            <a href="/docs/getting-started.html#_">
              Getting started with Fresco
            </a>
            
          </li>
        
          <li>
            <a href="/docs/concepts.html#_">
              Concepts
            </a>
            
          </li>
        
          <li>
            <a href="/docs/supported-uris.html#_">
              Supported URIs
            </a>
            
          </li>
        
      </ul>
    </section>
  
    <section>
      <h3>Drawee Guide</h3>
      <ul>
        
          <li>
            <a href="/docs/using-drawees-xml.html#_">
              Using Drawees in XML
            </a>
            
          </li>
        
          <li>
            <a href="/docs/using-drawees-code.html#_">
              Using Drawees in Code
            </a>
            
          </li>
        
          <li>
            <a href="/docs/drawee-components.html#_">
              Drawee Components
            </a>
            
          </li>
        
          <li>
            <a href="/docs/progress-bars.html#_">
              Progress Bars
            </a>
            
          </li>
        
          <li>
            <a href="/docs/scaling.html#_">
              Scaling
            </a>
            
          </li>
        
          <li>
            <a href="/docs/rounded-corners-and-circles.html#_">
              Rounded Corners and Circles
            </a>
            
          </li>
        
          <li>
            <a href="/docs/using-controllerbuilder.html#_">
              Using the ControllerBuilder
            </a>
            
          </li>
        
          <li>
            <a href="/docs/progressive-jpegs.html#_">
              Progressive JPEGs
            </a>
            
          </li>
        
          <li>
            <a href="/docs/animations.html#_">
              Animated Images
            </a>
            
          </li>
        
          <li>
            <a href="/docs/requesting-multiple-images.html#_" class="active">
              Requesting Multiple Images
            </a>
            
          </li>
        
          <li>
            <a href="/docs/listening-download-events.html#_">
              Listening to Download Events
            </a>
            
          </li>
        
          <li>
            <a href="/docs/resizing-rotating.html#_">
              Resizing and Rotating
            </a>
            
          </li>
        
          <li>
            <a href="/docs/modifying-image.html#_">
              Modifying the Image
            </a>
            
          </li>
        
          <li>
            <a href="/docs/image-requests.html#_">
              Image Requests
            </a>
            
          </li>
        
          <li>
            <a href="/docs/writing-custom-views.html#_">
              Writing Custom Views
            </a>
            
          </li>
        
          <li>
            <a href="/docs/gotchas.html#_">
              Gotchas
            </a>
            
          </li>
        
      </ul>
    </section>
  
    <section>
      <h3>Image Pipeline Guide</h3>
      <ul>
        
          <li>
            <a href="/docs/intro-image-pipeline.html#_">
              Introduction to the Image Pipeline
            </a>
            
          </li>
        
          <li>
            <a href="/docs/configure-image-pipeline.html#_">
              Configuring the Image Pipeline
            </a>
            
          </li>
        
          <li>
            <a href="/docs/caching.html#_">
              Cache Behavior
            </a>
            
          </li>
        
          <li>
            <a href="/docs/using-image-pipeline.html#_">
              Using the Image Pipeline Directly
            </a>
            
          </li>
        
          <li>
            <a href="/docs/datasources-datasubscribers.html#_">
              DataSources and DataSubscribers
            </a>
            
          </li>
        
          <li>
            <a href="/docs/closeable-references.html#_">
              Closeable References
            </a>
            
          </li>
        
      </ul>
    </section>
  
    <section>
      <h3>Third Party Libraries</h3>
      <ul>
        
          <li>
            <a href="/docs/using-other-network-layers.html#_">
              Using Other Network Layers
            </a>
            
          </li>
        
          <li>
            <a href="/docs/using-other-image-loaders.html#_">
              Using Other Image Loaders
            </a>
            
          </li>
        
      </ul>
    </section>
  
    <section>
      <h3>Contributing to Fresco</h3>
      <ul>
        
          <li>
            <a href="/docs/building-from-source.html#_">
              Building from Source
            </a>
            
          </li>
        
      </ul>
    </section>
  
</nav>


<article class='withtoc'>
    <h1>
      Requesting Multiple Images (Multi-URI)
      <a class="edit-page-link" href="https://github.com/facebook/fresco/tree/gh-pages/docs/01-requesting-multiple-images.md" target="_blank">Edit on GitHub</a>
    </h1>
    <p></p>

    <p>The methods on this page require <a href="using-controllerbuilder.html">setting your own image request</a>.</p>

<h3>Going from low to high resolution</h3>

<p>Suppose you want to show users a high-resolution, slow-to-download image. Rather than let them stare a placeholder for a while, you might want to quickly download a smaller thumbnail first.</p>

<p>You can set two URIs, one for the low-res image, one for the high one:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Uri</span> <span class="n">lowResUri</span><span class="o">,</span> <span class="n">highResUri</span><span class="o">;</span>
<span class="n">DraweeController</span> <span class="n">controller</span> <span class="o">=</span> <span class="n">Fresco</span><span class="o">.</span><span class="na">newDraweeControllerBuilder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">setLowResImageRequest</span><span class="o">(</span><span class="n">ImageRequest</span><span class="o">.</span><span class="na">fromUri</span><span class="o">(</span><span class="n">lowResUri</span><span class="o">))</span>
    <span class="o">.</span><span class="na">setImageRequest</span><span class="o">(</span><span class="n">ImageRequest</span><span class="o">.</span><span class="na">fromUri</span><span class="o">(</span><span class="n">highResUri</span><span class="o">))</span>
    <span class="o">.</span><span class="na">setOldController</span><span class="o">(</span><span class="n">mSimpleDraweeView</span><span class="o">.</span><span class="na">getController</span><span class="o">())</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">mSimpleDraweeView</span><span class="o">.</span><span class="na">setController</span><span class="o">(</span><span class="n">controller</span><span class="o">);</span>
</code></pre></div>
<h3>Using thumbnail previews</h3>

<p><em>This option is supported only for local URIs, and only for images in the JPEG format.</em></p>

<p>If your JPEG has a thumbnail stored in its EXIF metadata, the image pipeline can return that as an intermediate result. Your Drawee will first show the thumbnail preview, then the full image when it has finished loading and decoding.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Uri</span> <span class="n">uri</span><span class="o">;</span>
<span class="n">ImageRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="n">ImageRequestBuilder</span><span class="o">.</span><span class="na">newBuilderWithSource</span><span class="o">(</span><span class="n">uri</span><span class="o">)</span>
    <span class="o">.</span><span class="na">setLocalThumbnailPreviewsEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="n">DraweeController</span> <span class="n">controller</span> <span class="o">=</span> <span class="n">Fresco</span><span class="o">.</span><span class="na">newDraweeControllerBuilder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">setImageRequest</span><span class="o">(</span><span class="n">request</span><span class="o">)</span>
    <span class="o">.</span><span class="na">setOldController</span><span class="o">(</span><span class="n">mSimpleDraweeView</span><span class="o">.</span><span class="na">getController</span><span class="o">())</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">mSimpleDraweeView</span><span class="o">.</span><span class="na">setController</span><span class="o">(</span><span class="n">controller</span><span class="o">);</span>
</code></pre></div>
<h3>Loading the first available image</h3>

<p>Most of the time, an image has no more than one URI. Load it, and you&#39;re done.</p>

<p>But suppose you have multiple URIs for the same image. For instance, you might have uploaded an image taken from the camera. Original image would be too big to upload, so the image is downscaled first. In such case, it would be beneficial to first try to get the local-downscaled-uri, then if that fails, try to get the local-original-uri, and if even that fails, try to get the network-uploaded-uri. It would be a shame to download the image that we may have already locally. </p>

<p>The image pipeline normally searches for images in the memory cache first, then the disk cache, and only then goes out to the network or other source. Rather than doing this one by one for each image, we can have the pipeline check for <em>all</em> the images in the memory cache. Only if none were found would disk cache be searched in. Only if none were found there either would an external request be made.</p>

<p>Just create an array of image requests, and pass it to the builder.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Uri</span> <span class="n">uri1</span><span class="o">,</span> <span class="n">uri2</span><span class="o">;</span>
<span class="n">ImageRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="n">ImageRequest</span><span class="o">.</span><span class="na">fromUri</span><span class="o">(</span><span class="n">uri1</span><span class="o">);</span>
<span class="n">ImageRequest</span> <span class="n">request2</span> <span class="o">=</span> <span class="n">ImageRequest</span><span class="o">.</span><span class="na">fromUri</span><span class="o">(</span><span class="n">uri2</span><span class="o">);</span>
<span class="n">ImageRequest</span><span class="o">[]</span> <span class="n">requests</span> <span class="o">=</span> <span class="o">{</span> <span class="n">request1</span><span class="o">,</span> <span class="n">request2</span> <span class="o">};</span>

<span class="n">DraweeController</span> <span class="n">controller</span> <span class="o">=</span> <span class="n">Fresco</span><span class="o">.</span><span class="na">newDraweeControllerBuilder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">setFirstAvailableImageRequests</span><span class="o">(</span><span class="n">requests</span><span class="o">)</span>
    <span class="o">.</span><span class="na">setOldController</span><span class="o">(</span><span class="n">mSimpleDraweeView</span><span class="o">.</span><span class="na">getController</span><span class="o">())</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">mSimpleDraweeView</span><span class="o">.</span><span class="na">setController</span><span class="o">(</span><span class="n">controller</span><span class="o">);</span>
</code></pre></div>
<p>Only one of the requests will be displayed. The first one found, whether at memory, disk, or network level, will be the one returned. The pipeline will assume the order of requests in the array is the preference order. </p>

<h3>Specifying a custom <code>DataSource</code> <code>Supplier</code></h3>

<p>For even more flexibility, it is possible to specify a custom <code>DataSource</code> <code>Supplier</code> while building a Drawee controller. You can implement your own supplier or just compose the existing ones in whichever way you like. See  <code>FirstAvailableDataSourceSupplier</code> and <code>IncreasingQualityDataSourceSupplier</code> for an example implementation. See <code>AbstractDraweeControllerBuilder</code> for how those suppliers can be composed together.</p>


    <div class="docs-prevnext">
      
        <a href="/docs/animations.html#_">&larr; Prev</a>
      
      
        <a class="right" href="/docs/listening-download-events.html#_">Next &rarr;</a>
      
    </div>

    <a id="_"></a>
</article>

</div></section>
<footer><div class='width'>
    &copy; Copyright 2015, Facebook Inc.<br>
    Documentation licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. Sample code licensed under the <a href="/sample-license.html">sample license</a>.
</div></footer>

<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
  ga('create', 'UA-44373548-3', 'auto');
  ga('send', 'pageview');
 
</script>
<script src="/static/linkify.js"></script>
</body>
</html>

